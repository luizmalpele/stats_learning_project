---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

```{r}
library(tidyverse)
library(caret)
library(DataExplorer)
library(fastDummies)
library(leaps)
library(cowplot)
library(GGally)
```
## Dataset
Import processed data, which can be found [here] ("https://github.com/luizmalpele/stats_learning_project/blob/master/data/data.Rmd")

```{r}
#read preprocessed data
college_data <- read.csv(file = '../data/college_data.csv')
```

View data info
```{r}
glimpse(college_data)
```

Use DataExplorer to automatically create an EDA
```{r}
create_report(college_data)
```

EDA etc

```{r}
#overlay early pay distribution with middle play distribution
college_data %>% 
  ggplot() +
  geom_histogram(mapping = aes(x = early_career_pay), 
                 fill = "red",
                 alpha = 0.6) +
  geom_histogram(mapping = aes(x = mid_career_pay), 
                 fill = "blue",
                 alpha = 0.6) +
  xlab("Pay") +
  ylab("Count") +
  theme_minimal()
```

What types of colleges want to make the world better?
  (maybe subset grep(Art, creative) and grep(health, nursing) and compare boxplots of 'make_world_better_percent')
```{r}
college_data %>% 
  filter(!is.na(make_world_better_percent)) %>% 
  select(name, make_world_better_percent) %>% 
  arrange(make_world_better_percent)
```


Useful for EDA:
-make a correlation matrix

Questions these models hope to answer
-Does the aspiration of making the world better have an impact on the mid career payment?
  -How does it affect the early stage of a students career?
  -Does it apply to only some specific fields?

-Are more diverse schools likely to have a higher % of alumni who want to change the world?

-Do lower tuition and fees cause people to want to care more about the world?

Translate these questions into statistical models:
What variables most impacts mid level pay? (LASSO or PCA + linear regression)




```{r}
college_dataset <-  college_data %>% 
  dummy_cols(select_columns = "degree_length") %>% 
  dummy_cols(select_columns = "type") %>% 
  rename(length_2y="degree_length_2 Year", 
         length_4y="degree_length_4 Year", 
         for_profit="type_For Profit", 
         private="type_Private", 
         public = "type_Public") %>% 
  select(-degree_length_Other, -type_Other) %>%  
  filter(!is.na(make_world_better_percent)) %>% 
  filter(!is.na(total_enrollment)) %>% 
  mutate(women_ratio=round(women/total_enrollment*100, 2),
         native_american_ratio=round(native_american/total_enrollment*100, 2),
         asian_ratio=round(asian/total_enrollment*100, 2),
         black_ratio=round(black/total_enrollment*100, 2),
         hispanic_ratio=round(hispanic/total_enrollment*100, 2),
         pacific_islander_ratio=round(pacific_islander/total_enrollment*100, 2),
         white_ratio=round(white/total_enrollment*100, 2),
         minority_ratio=round(total_minority/total_enrollment*100, 2)) %>% 
  mutate(ln_early_career_pay=log(early_career_pay),
         ln_mid_career_pay=log(mid_career_pay),
         ln_in_state_tuition=log(in_state_tuition),
         ln_in_state_total=log(in_state_total),
         ln_out_of_state_tuition=log(out_of_state_tuition),
         ln_out_of_state_total=log(out_of_state_total),
         ln_room_and_board=log(room_and_board))
college_dataset
```

- Colleges for Profit did not collected data on "Make World Better".

```{r}
create_report(college_dataset)
```

```{r}
college_dataset %>% 
  ggplot() +
  geom_histogram(mapping = aes(x = early_career_pay), 
                 fill = "red",
                 alpha = 0.6) +
  geom_histogram(mapping = aes(x = mid_career_pay), 
                 fill = "blue",
                 alpha = 0.6) +
  xlab("Pay") +
  ylab("Count") +
  theme_minimal()
```


```{r}
college_dataset_shrinked <- college_dataset %>% 
  select(ln_early_career_pay, 
         ln_mid_career_pay, 
         make_world_better_percent,
         minority_ratio, 
         ln_out_of_state_total, 
         ln_in_state_total, 
         stem_percent)

college_dataset_shrinked2 <- college_dataset %>% 
  select(ln_early_career_pay, 
         ln_mid_career_pay, 
         make_world_better_percent, 
         minority_ratio, 
         hispanic_ratio, 
         asian_ratio, 
         black_ratio, 
         hispanic_ratio, 
         white_ratio)
```

```{r}
ggpairs(data = college_dataset_shrinked, lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.1)))
```

```{r}
ggpairs(data = college_dataset_shrinked2, lower = list(continuous = wrap("smooth", alpha = 0.3, size=0.1)))
```

```{r}
college_dataset %>% 
  ggplot() + 
  geom_point(aes(x=ln_out_of_state_total, y=make_world_better_percent, color = type), alpha = 0.6) + 
  labs(
    title = "Log of Out of State Total versus Percentage of Students seeking a Better World ", 
    x = "Log of Out of State Total", 
    y = "Percentage Students seeking a Better World", 
    color = "Type of Institution") + scale_color_brewer(palette = "Set1")
```

```{r}
college_dataset %>% 
  ggplot() + 
  geom_point(aes(x=ln_out_of_state_total, y=ln_early_career_pay, color = type), alpha = 0.6) + 
  labs(
    title = "Log of Out of State Total versus Percentage of Students seeking a Better World ", 
    x = "Log of Out of State Total", 
    y = "Percentage Students seeking a Better World", 
    color = "Type of Institution") + scale_color_brewer(palette = "Set1")
```

